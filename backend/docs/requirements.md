# ECサイト価格追跡システム 要件定義書（v1.2）

## 1. プロジェクト概要

### プロジェクト名

ECサイト価格追跡通知システム「PriceAlert」

### 背景・目的

昨今のネットショッピングの普及により、消費者は複数のECサイトを比較しながら商品購入を検討することが一般的になっています。しかし、各サイトの価格変動を継続的に監視することは時間と労力を要します。本プロジェクトでは、複数の主要ECサイトから特定商品の価格情報を自動収集し、価格変動を追跡・通知するシステムを開発することで、ユーザーの購買決定をサポートするとともに、アフィリエイトリンクを通じた収益化を実現します。

### 対象ユーザー

価格変動を把握した上で最適なタイミングでの購入を希望する一般消費者。特に、ガジェット、家電、書籍など価格変動が頻繁に起こる商品カテゴリーに関心を持つユーザーを主なターゲットとします。

## 2. システム概要

### システム全体のコンセプトと連携概要

「PriceAlert」は、ユーザーが指定した商品の価格情報を複数のECサイト（Amazon、楽天市場、Yahoo!ショッピング等）から定期的に収集し、価格の変動を追跡・分析するWebアプリケーションです。**実質価格（獲得ポイントを加味した実質的な支払い額）を計算して表示**することで、より正確な価格比較をサポートします。ユーザーが設定した価格閾値を下回った場合には、メール通知によりユーザーに情報を提供します。また、購入リンクはアフィリエイトリンクに変換され、ユーザーの購入行動による収益化も図ります。

### 利用するプラットフォームや主要な外部サービス

- **プラットフォーム**: Webアプリケーション（レスポンシブデザイン）
- **バックエンド**: Django
- **フロントエンド**: React
- **主要ECサイト**: Amazon、楽天市場、Yahoo!ショッピング（優先対応）
- **外部API/サービス**:
    - 各ECサイトの商品検索・価格取得API
    - 各ECサイトのアフィリエイトプログラムAPI
    - メール送信サービス（SendGrid等）
    - データベースサービス
    - ウェブホスティングサービス

## 3. ユーザーエクスペリエンス（UX）設計

### UX全体コンセプト

「シンプルで直感的、でも必要な情報がすぐに得られる」をUXコンセプトとします。ユーザーが複雑な設定や操作を必要とせず、必要最小限のステップで価格追跡を開始できるよう設計します。また、視覚的に価格変動を把握できるグラフ表示を重視し、情報の理解しやすさを追求します。

### 主要ユーザージャーニー

### 1. 初回訪問・登録フロー

- **期待する体験**: 3分以内に登録から商品追加までを完了できること
- **フロー詳細**:
    1. ランディングページで「PriceAlert」の価値提案を明確に提示
    2. シンプルな登録フォーム（メールアドレス、パスワードのみ）
    3. 登録完了後、すぐにダッシュボードへ誘導
    4. 「最初の商品を追加」ガイド表示による次のアクションの明確化
    5. 初回登録特典として「ショッピングTips」PDFのダウンロード提供

### 2. 商品追加フロー

- **期待する体験**: URLコピペか検索だけで完了する手軽さ
- **フロー詳細**:
    1. 商品URL入力フォームを目立つ位置に配置
    2. URL貼り付け後、自動的に商品情報を取得・表示
    3. 価格アラート設定をスライダーUIで簡単に設定可能
    4. 複数ECサイトから同一商品を自動で検索・提案
    5. 1クリックでの追加完了

### 3. 価格確認・分析フロー

- **期待する体験**: 直感的に価格変動トレンドが把握できること
- **フロー詳細**:
    1. ダッシュボードに登録商品の現在価格と変動状況をカード形式で表示
    2. カードクリックで詳細ページへ遷移
    3. インタラクティブなグラフで期間変更や詳細表示が可能
    4. 「最適購入タイミング」分析結果を視覚的に表示
    5. 「類似商品」「代替品」の推奨表示

### 4. 通知受信・購入アクション

- **期待する体験**: 適切なタイミングで有用な通知を受け取り、スムーズに購入へ移行できること
- **フロー詳細**:
    1. メール通知にはグラフサムネイルと具体的な価格情報を掲載
    2. ワンクリックでアプリにアクセス可能
    3. アフィリエイトリンク付きの「今すぐ購入」ボタンを目立つ位置に配置
    4. 購入後のフィードバック収集（「このアラートは役立ちましたか？」）
    5. 次の商品追加への誘導

### UX重点ポイント

### 1. オンボーディング体験

- 初回ログイン時のインタラクティブツアーを実装
- 「クイックスタート」ガイドの提供
- 空の状態（商品未登録時）でも魅力的に見えるデザイン

### 2. ビジュアルフィードバック

- 価格下落時には緑色、上昇時には赤色のビジュアルキューを使用
- 価格変動の大きさを視覚的に表現（矢印の大きさなど）
- アニメーションによるデータ更新の視覚化

### 3. パーソナライゼーション

- ユーザーの行動パターンを学習し、関連商品を推奨
- 利用頻度の高い機能をダッシュボードでハイライト表示
- パーソナライズされたレポート（「あなたの節約額」など）

### 4. マイクロインタラクション

- スムーズなトランジションとアニメーション
- 操作成功時の小さな達成感を演出するエフェクト
- データ更新中のスケルトンローディング表示

## 4. 機能要件

### ユーザー管理機能

- **ユーザー登録・認証機能**
    - メールアドレスとパスワードによる基本認証
    - パスワード再設定機能
    - アカウント情報管理機能
- **ユーザー設定**
    - 通知設定（通知頻度、通知条件など）
    - メールアドレス変更
    - アカウント削除
    - 通知購読管理（カテゴリー別、商品別）

### 商品登録・管理機能

- **商品登録機能**
    - URL直接入力による商品登録（アフィリエイトリンク自動変換）
    - 商品名/キーワード検索による商品登録
    - 商品情報の自動取得（タイトル、画像、初期価格等）
    - バーコードスキャン対応（モバイル版）
- **登録商品管理**
    - 登録商品一覧表示（ソート・フィルタ機能付き）
    - 商品ごとの価格アラート設定
    - 登録商品の削除・編集
    - ユーザーあたり最大30商品まで登録可能
    - ドラッグ＆ドロップによる優先順位変更

### アフィリエイト機能

- **アフィリエイトリンク管理**
    - 各ECサイトのアフィリエイトIDの統合管理
    - 入力URLの自動アフィリエイトリンク変換
    - 短縮URL生成によるユーザー利便性向上
- **アフィリエイト最適化**
    - ECサイトごとの最適なアフィリエイトパラメータ設定
    - クリック追跡によるコンバージョン分析
    - パーソナライズされたアフィリエイトリンク（ユーザーの閲覧履歴に基づく）

### 価格情報収集機能

- **ECサイトからのデータ収集**
    - 各ECサイトのAPI利用（Amazon PA-API, 楽天商品検索API, Yahoo!ショッピングAPI）
    - スクレイピングによるデータ収集（API不足時）
    - 1日1回の定期的なデータ更新
    - エラーハンドリングと再試行メカニズム
    - 価格以外の情報（**獲得ポイント、ポイント還元率**、在庫状態、配送情報、セール情報）の収集
- **同一商品の自動マッチング**
    - 商品名、型番、JANコード等を活用した商品同定
    - 画像認識技術を活用した類似商品マッチング
    - 類似商品の推定アルゴリズム実装
    - ユーザーによる手動マッチング機能（補助的）

### 価格分析・表示機能

- **価格履歴管理**
    - 時系列での価格データ保存
    - 過去の最安値・最高値の記録
    - ECサイト別の価格比較
    - **「定価」「販売価格」「獲得ポイント」「実質価格（販売価格-獲得ポイント）」の4種類の価格表示**
    - 価格変動パターンの分析
    - **各ECサイトの実質価格ランキング表示**
- **グラフ表示機能**
    - 時系列での価格変動グラフ表示（ズーム・パン機能付き）
    - **実質価格と表示価格の両方を切り替え可能なグラフ表示**
    - 複数ECサイト間の価格比較グラフ
    - グラフ期間の可変表示（週間/月間/年間）
    - 特定イベント（セール、新製品発売）のマーキング
    - 購入最適タイミング予測表示

### 通知機能

- **価格アラート設定**
    - 商品ごとの価格閾値設定
    - **実質価格または表示価格のどちらかを基準としたアラート設定オプション**
    - 最低価格からの上昇アラート設定
    - 期間指定アラート（例：1週間以内に最安値を下回ったら通知）
    - 価格下落率基準のアラート（例：20%以上値下がりしたら通知）
- **通知配信**
    - メールによる価格変動通知（モバイルフレンドリーデザイン）
    - 定期的な価格レポート
    - システム通知（メンテナンス情報等）
    - 通知内にアフィリエイトリンクを含める

### レビュー・評価情報

- **レビュー収集機能**
    - 各ECサイトからの評価スコア収集
    - レビュー数のトラッキング
    - レビュー内容のキーワード分析
    - レビュー増減の通知機能
- **レビュー分析**
    - 評価スコアの時系列変化表示
    - サイト間の評価比較
    - センチメント分析（ポジティブ/ネガティブ評価の割合）
    - キーワードクラウド表示

### API機能

- **外部連携用APIエンドポイント**
    - 商品検索API
    - 価格情報取得API
    - 登録商品情報取得API
    - 認証API
- **API利用制限**
    - レート制限の実装
    - アクセストークンによる認証

### ユーザーインターフェース

- **レスポンシブWebデザイン**
    - デスクトップ/タブレット/モバイル対応
    - 直感的な操作性
    - アクセシビリティ対応
    - ダークモード対応
- **ダッシュボード**
    - 登録商品の概要表示
    - 価格変動の可視化
    - 最新の価格アラート情報
    - カスタマイズ可能なウィジェット配置

## 5. 非機能要件

### パフォーマンス

- ページロード時間：3秒以内
- データ更新処理：1日1回の一括処理で全登録商品の情報更新を1時間以内に完了
- 同時アクセスユーザー：最大20ユーザーの同時アクセスに対応
- API応答時間：95%のリクエストが500ms以内に応答
- モバイル端末での最適化：データ使用量の最小化

### セキュリティ

- ユーザー認証情報の安全な管理（パスワードハッシュ化）
- HTTPS通信の採用
- CSRF対策、XSS対策の実装
- API利用時の適切な認証・認可
- データベースへのアクセス制御
- スクレイピング実行時のユーザーエージェント設定と適切なアクセス間隔の確保
- Django組み込みセキュリティ機能の活用

### 可用性

- システム稼働率：99%（計画的なメンテナンス時間を除く）
- バックアップ：1日1回のデータベースバックアップ
- 障害復旧：障害発生時の復旧手順の確立
- エラー発生時の適切なログ記録とアラート通知
- 定期メンテナンス時の事前通知システム

### 保守性・拡張性

- モジュール化された設計によるコードの再利用性向上
- 新規ECサイト追加時の容易な拡張性確保
- 設定ファイルによる動作パラメータの外部化
- 詳細なコメントとドキュメント作成
- コンポーネントベースのフロントエンド設計（Vue.js）

### スケーラビリティ

- 将来的なユーザー数増加に対応可能な設計
- データベースの水平/垂直スケーリングを考慮
- スクレイピング処理の分散化対応
- キャッシュ戦略の実装

## 6. 技術スタック詳細

### バックエンド

- **フレームワーク**: Django 5.0
- **API**: Django REST Framework
- **データベース**: PostgreSQL
- **キャッシュ**: Redis
- **タスクキュー**: Celery（定期実行タスク用）
- **データ収集**: BeautifulSoup/Scrapy, 各ECサイトAPI連携
- **データ分析**: Pandas, NumPy

### フロントエンド

- **フレームワーク**: React 18.x
- **状態管理**: Redux Toolkit
- **UI コンポーネント**: Material-UI (MUI)
- **グラフ表示**: Recharts
- **API クライアント**: Axios
- **ビルドツール**: Vite

### インフラストラクチャ

- **コンテナ化**: Docker, Docker Compose
- **CI/CD**: GitHub Actions
- **ホスティング**: AWS (EC2, RDS, S3)
- **監視**: Prometheus, Grafana
- **ロギング**: ELK Stack (Elasticsearch, Logstash, Kibana)

## 7. ペルソナ視点からの要件分析

### 佐藤健太（35歳）の視点による要件

### 1. 情報の見やすさと理解しやすさ

健太さんはITリテラシーが高いものの、忙しい会社員であり効率的に情報を得たいと考えています。

**具体的要件:**

- ダッシュボードでは1画面で全登録商品の状況が把握できること
- 価格変動の大きい商品を目立つ形で表示
- 過去1ヵ月の変動を一目で確認できるバッジ表示
- 「今買うべき？待つべき？」の判断材料を明示

### 2. 手間のかからない操作性

健太さんは家族との時間を大切にしており、システム操作に時間をかけたくありません。

**具体的要件:**

- URLの貼り付けだけで商品登録が完了する設計
- 同一商品を別ECサイトで探す場合もワンクリックで完結
- テンプレート化された価格アラート設定（15%オフ、過去最安値など）
- 設定変更の簡素化（トグルスイッチ活用）

### 3. 実用的な通知

健太さんはオンラインショッピングに慣れており、本当に必要な情報だけを得たいと考えています。

**具体的要件:**

- 通知頻度のカスタマイズ（日次/週次/重要な変動のみ）
- 通知内容の充実（価格変動グラフ、過去価格との比較情報）
- 購入判断に役立つ追加情報（レビュー評価の変化、在庫状況）
- 「今がお買い時」判定基準の明確化と表示

### 4. 節約効果の可視化

健太さんは価格に敏感で、このシステムによる節約効果を実感したいと考えています。

**具体的要件:**

- 「PriceAlertでの節約額」の累計表示
- 最安値で購入できた場合の節約シミュレーション
- 月次の「賢い買い物レポート」の提供
- 友人と節約額を共有できるソーシャル機能（オプション）

## 8. アフィリエイト連携詳細

### アフィリエイト変換プロセス

- **商品URL登録時**:
    1. ユーザーが入力したURLからECサイトと商品IDを抽出
    2. 該当ECサイトのアフィリエイトプログラム用URL構造に変換
    3. アフィリエイトIDを付与したリンクを生成・保存
    4. 元URLはデータ更新用に別途保存
- **ショート URL生成**:
    1. 長いアフィリエイトURLを内部URL短縮システムで短縮
    2. 短縮URLにはトラッキングパラメータを付与
    3. クリック計測システムと連携

### ECサイト別アフィリエイト対応

- **Amazon**:
    - Amazon アソシエイトAPIとの連携
    - 商品リンク内にタグパラメータ付与
    - 通知メール内に商品画像付きアフィリエイトリンク設置
    - **Amazonポイント還元情報の取得と表示**
- **楽天市場**:
    - 楽天ウェブサービスAPIとの連携
    - アフィリエイトID付与と収益トラッキング
    - 楽天ポイントキャンペーン情報の付加価値提供
    - **楽天ポイント還元率・SPU情報の取得と実質価格計算**
- **Yahoo!ショッピング**:
    - バリューコマースとの連携
    - 商品リンクの自動変換
    - **PayPayポイント還元率の取得と実質価格計算**

### アフィリエイト最適化施策

- **コンバージョン率向上**:
    - 「今がお買い得」バッジでの視覚的訴求
    - 通知タイミングの最適化（夕方・週末など購買意欲が高い時間帯）
    - メール内の商品レビューハイライト表示
- **ユーザー体験との両立**:
    - アフィリエイトリンクであることの適切な表示
    - 購入後のフィードバックによるリンク改善
    - リンククリック分析によるUI/UX最適化

## 9. 制約条件・前提条件

### ビジネス制約

- 個人開発のため予算制約あり（低コストサービスの活用）
- 初期ユーザー数は少数（10名/月）だが、将来の拡張性を考慮
- 各ECサイトの利用規約遵守（特にスクレイピング実施時）
- アフィリエイトプログラムの規約遵守

### 法的制約

- 個人情報保護法の遵守
- ECサイトのロボット排除規約（robots.txt）の遵守
- アフィリエイト収益の適切な税務処理
- 景品表示法に則った表示（最安値表記など）

## 10. リスク分析と対応策

### 技術的リスク

- **スクレイピングブロックリスク**
    - 対応策: APIの優先利用、適切なアクセス間隔設定、複数IPアドレスの利用検討
- **ECサイトの構造変更リスク**
    - 対応策: サイト構造変更の検知機能、モジュール化による影響範囲の局所化
- **同一商品特定の精度リスク**
    - 対応策: 複数の識別子（JANコード、商品名、メーカー名等）の組み合わせ利用、ユーザーによる手動修正機能
- **アフィリエイトリンク規約変更リスク**
    - 対応策: 定期的な規約確認、迅速な変更対応体制

### 運用リスク

- **データ更新の失敗**
    - 対応策: エラーログ記録、再試行メカニズム、管理者通知機能
- **サーバー負荷増大**
    - 対応策: 負荷監視、スケジューリングの最適化、処理の分散化
- **不正アクセス・攻撃**
    - 対応策: セキュリティ監視、適切な認証・認可、入力検証
- **ユーザー離脱リスク**
    - 対応策: エンゲージメント施策、定期的なフィードバック収集

### ビジネスリスク

- **ECサイト側からのAPI制限強化**
    - 対応策: 複数の情報取得手段の確保、代替データソースの検討
- **類似サービスとの競合**
    - 対応策: 独自機能の強化、ユーザー体験の最適化
- **アフィリエイト報酬減少リスク**
    - 対応策: 収益源の多様化、付加価値サービスの検討

## 11. MVPリリース計画とロードマップ

### MVPの定義と範囲

**MVPでは以下の最小限の機能セットに絞ってリリースします：**

1. **コア機能**
    - ユーザー登録・認証（メールアドレス・パスワードのみ）
    - URL入力による商品登録（Amazon対応のみ）
    - 基本的な価格追跡（販売価格のみ、実質価格計算なし）
    - シンプルな価格履歴グラフ表示
    - 基本的なメール通知（価格下落時のみ）
    - 基本的なアフィリエイト機能（Amazonのみ）
2. **MVPにおけるUI/UX**
    - 最小限のダッシュボード（登録商品一覧と現在価格）
    - シンプルな商品詳細ページ（価格履歴グラフ）
    - 基本的な商品登録フロー
    - レスポンシブデザイン（モバイル・デスクトップ対応）
3. **MVPの技術スタック制限**
    - バックエンド: Django
    - フロントエンド: Vue.js（最小限のコンポーネント）
    - データベース: SQLite（初期段階）
    - スケジューリング: 基本的なCronジョブ
    - ホスティング: 低コストのクラウドサービス

### MVPリリーススケジュール（3ヶ月）

- **第1ヶ月**: 基盤開発
    - 週1-2: 要件定義完了、最小限のデータベース設計
    - 週3-4: Djangoプロジェクト構築、ユーザー認証
- **第2ヶ月**: コア機能開発
    - 週1-2: Amazonデータ取得機能開発
    - 週3-4: 価格履歴保存とシンプルなグラフ表示
- **第3ヶ月**: MVP完成とリリース
    - 週1-2: 通知機能、基本的なアフィリエイト機能
    - 週3-4: テストとMVPリリース

### フィードバック収集計画

- 限定ユーザー（10-20名）へのアクセス提供
- フィードバックフォームの設置
- 利用状況の分析（登録商品数、閲覧頻度、通知反応率）
- ユーザーインタビュー（5-10名）の実施

### ポストMVP開発計画（優先度順）

1. **第1拡張（2ヶ月）**:
    - **実質価格計算機能の追加**（獲得ポイントを考慮した価格表示）
    - 楽天市場対応
    - 価格アラート設定の多様化
2. **第2拡張（2ヶ月）**:
    - Yahoo!ショッピング対応
    - グラフ機能の強化（実質価格／表示価格の切り替え表示）
    - ECサイト間の価格比較強化
3. **第3拡張（3ヶ月）**:
    - レビュー情報収集機能
    - 類似商品推奨機能
    - ダッシュボードのカスタマイズ機能
4. **将来拡張（要検討）**:
    - 高度な価格予測機能
    - モバイルアプリ開発
    - ソーシャル共有機能
    - 有料プラン（高度な分析、登録商品数増加）

## 12. 今後のステップ

### MVP開発に向けた直近のアクション

- Amazon APIの連携テスト実施
- 実質価格計算のためのポイント情報取得方法の検証
- MVPのUIワイヤーフレーム作成
- フィードバック収集方法の確立
- MVPリリースに必要な最小限のインフラ選定

---

**注記:**

本要件定義書は初期情報と追加要望に基づいて作成されています。MVPリリースを最初の目標としながら、段階的に機能を拡張していく計画としています。特に実質価格計算機能は第1拡張フェーズでの実装を予定し、ユーザーからのフィードバックを重視して改善を進めていきます。

ペルソナの視点に基づいた機能優先順位付けやUX設計は、初期フィードバックを得ながら継続的に改善していくことが望ましいと考えます。