# ECサイト価格追跡システム「PriceAlert」基本設計書

**バージョン:** 1.0

**作成日:** 2025年4月5日

**作成者:** プロジェクトマネージャー/システムエンジニア

## 目次

1. [システム概要](#1-システム概要)
2. [システムアーキテクチャ](#2-システムアーキテクチャ)
3. [データベース設計](#3-データベース設計)
4. [外部インターフェース設計](#4-外部インターフェース設計)
5. [画面設計](#5-画面設計)
6. [処理フロー設計](#6-処理フロー設計)
7. [セキュリティ設計](#7-セキュリティ設計)
8. [インフラストラクチャ設計](#8-インフラストラクチャ設計))
9. [性能要件と対策](#9-性能要件と対策)
10. [MVPリリース計画](#10-mvpリリース計画)
11. [テスト計画](#11-テスト計画)
12. [運用・保守設計](#12-運用保守設計)

## 1. システム概要

### 1.1 システム目的

「PriceAlert」は、複数のECサイト（Amazon、楽天市場、Yahoo!ショッピング等）から商品価格情報を自動収集し、価格変動を追跡・分析・通知するウェブアプリケーションである。ユーザーが設定した価格閾値を下回った場合に通知し、購入判断をサポートする。また、アフィリエイトリンクを通じた収益化も実現する。

### 1.2 システム化範囲

以下の機能をシステム化の範囲とする：

- ユーザー管理（登録・認証・設定）
- 商品登録・管理
- 価格情報収集・分析
- 通知機能
- アフィリエイトリンク管理
- 管理機能

### 1.3 前提条件・制約条件

- ユーザーあたりの登録商品数上限：30件
- 開発・運用コストを最小限に抑える（可能な限り無料サービスを活用）
- 各ECサイトの利用規約およびAPI利用制限の遵守
- 個人情報保護法の遵守
- 初期ユーザー数は少数（10名/月）だが、将来の拡張性を考慮した設計

## 2. システムアーキテクチャ

### 2.1 全体アーキテクチャ

![](https://claude.ai/chat/arch_diagram.png)

※基本設計書の一部として、実際の図は別途添付

PriceAlertは以下のレイヤー構造で設計する：

1. **プレゼンテーション層**
    - Vue.js 3によるSPA（Single Page Application）
    - VuetifyによるレスポンシブなモバイルフレンドリーUI
2. **アプリケーション層**
    - Django REST Frameworkによるバックエンドサービス
    - JWT認証によるセキュアなAPI通信
3. **ビジネスロジック層**
    - Django MVTアーキテクチャに基づくビジネスロジック
    - Celeryによる非同期処理（データ収集・通知配信）
4. **データアクセス層**
    - ORMによるデータベース操作
    - 外部APIクライアント
5. **データ層**
    - データベース（初期はSQLite、本番環境はPostgreSQL）
    - Redisキャッシュ（オプション）

### 2.2 フロントエンド・バックエンド分離

- RESTful APIによるフロントエンドとバックエンドの疎結合
- APIゲートウェイパターンの採用（Django REST Framework）
- CSRFトークンやJWTトークンを用いたセキュアな通信

### 2.3 採用技術スタック

**MVPフェーズでの技術スタック:**

### バックエンド

- 言語：Python 3.12
- フレームワーク：Django 5.0
- API：Django REST Framework
- タスクキュー：Celery（非同期処理用）
- データベース：SQLite（初期）→ PostgreSQL（本番）
- キャッシュ：Django組み込みキャッシュ
- データ収集：BeautifulSoup/Scrapy、各ECサイトAPI

### フロントエンド

- フレームワーク：Vue.js 3
- 状態管理：Vuex
- UIコンポーネント：Vuetify
- グラフ表示：Chart.js
- APIクライアント：Axios
- ビルドツール：Vite

### インフラストラクチャ（MVPフェーズ）

- コンテナ化：Docker、Docker Compose
- CI/CD：GitHub Actions
- ホスティング：Render（無料枠）または Firebase Hosting + Cloud Functions
- ロギング：Django組み込みロガー

## 3. データベース設計

### 3.1 論理データモデル

以下の主要エンティティを定義する：

1. **User（ユーザー）**
    - ユーザー情報の管理
2. **Product（商品）**
    - 商品基本情報の管理
3. **UserProduct（ユーザー商品）**
    - ユーザーと商品の関連付け
    - アラート設定の管理
4. **PriceHistory（価格履歴）**
    - 商品の価格変動履歴の記録
5. **ECsite（ECサイト）**
    - 対応ECサイト情報の管理
6. **ProductMapping（商品マッピング）**
    - 異なるECサイト間の同一商品マッピング
7. **Notification（通知）**
    - 送信済み通知の管理
8. **AppSettings（アプリ設定）**
    - システム全体設定の管理

### 3.2 物理データモデル

### User（users）

| フィールド名 | データ型 | 制約 | 説明 |
| --- | --- | --- | --- |
| id | Integer | PK, AUTO_INCREMENT | ユーザーID |
| email | String(255) | UNIQUE, NOT NULL | メールアドレス |
| password | String(255) | NOT NULL | ハッシュ化パスワード |
| username | String(100) | NOT NULL | ユーザー名 |
| is_active | Boolean | NOT NULL, DEFAULT TRUE | アクティブ状態 |
| created_at | DateTime | NOT NULL | 作成日時 |
| updated_at | DateTime | NOT NULL | 更新日時 |
| last_login | DateTime | NULL | 最終ログイン日時 |

### UserSettings（user_settings）

| フィールド名 | データ型 | 制約 | 説明 |
| --- | --- | --- | --- |
| id | Integer | PK, AUTO_INCREMENT | 設定ID |
| user_id | Integer | FK(users.id), NOT NULL | ユーザーID |
| notification_frequency | String(20) | NOT NULL, DEFAULT 'daily' | 通知頻度（daily/weekly/immediately） |
| email_notifications | Boolean | NOT NULL, DEFAULT TRUE | メール通知有効フラグ |
| created_at | DateTime | NOT NULL | 作成日時 |
| updated_at | DateTime | NOT NULL | 更新日時 |

### ECsite（ec_sites）

| フィールド名 | データ型 | 制約 | 説明 |
| --- | --- | --- | --- |
| id | Integer | PK, AUTO_INCREMENT | ECサイトID |
| name | String(50) | NOT NULL | ECサイト名称 |
| code | String(20) | UNIQUE, NOT NULL | ECサイトコード |
| api_base_url | String(255) | NULL | API基本URL |
| affiliate_format | String(512) | NULL | アフィリエイトフォーマット |
| is_active | Boolean | NOT NULL, DEFAULT TRUE | アクティブ状態 |
| created_at | DateTime | NOT NULL | 作成日時 |
| updated_at | DateTime | NOT NULL | 更新日時 |

### Product（products）

| フィールド名 | データ型 | 制約 | 説明 |
| --- | --- | --- | --- |
| id | Integer | PK, AUTO_INCREMENT | 商品ID |
| name | String(255) | NOT NULL | 商品名 |
| description | Text | NULL | 商品説明 |
| image_url | String(512) | NULL | 商品画像URL |
| manufacturer | String(100) | NULL | メーカー |
| model_number | String(100) | NULL | 型番 |
| jan_code | String(20) | NULL | JANコード |
| created_at | DateTime | NOT NULL | 作成日時 |
| updated_at | DateTime | NOT NULL | 更新日時 |

### ProductOnECsite（product_on_ec_sites）

| フィールド名 | データ型 | 制約 | 説明 |
| --- | --- | --- | --- |
| id | Integer | PK, AUTO_INCREMENT | ID |
| product_id | Integer | FK(products.id), NOT NULL | 商品ID |
| ec_site_id | Integer | FK(ec_sites.id), NOT NULL | ECサイトID |
| ec_product_id | String(100) | NOT NULL | EC上の商品ID |
| product_url | String(512) | NOT NULL | 商品URL |
| affiliate_url | String(1024) | NULL | アフィリエイトURL |
| current_price | Decimal(10,2) | NULL | 現在価格 |
| current_points | Decimal(10,2) | NULL | 現在ポイント |
| effective_price | Decimal(10,2) | NULL | 実質価格（価格-ポイント） |
| last_updated | DateTime | NULL | 価格最終更新日時 |
| is_active | Boolean | NOT NULL, DEFAULT TRUE | アクティブ状態 |
| created_at | DateTime | NOT NULL | 作成日時 |
| updated_at | DateTime | NOT NULL | 更新日時 |

### UserProduct（user_products）

| フィールド名 | データ型 | 制約 | 説明 |
| --- | --- | --- | --- |
| id | Integer | PK, AUTO_INCREMENT | ID |
| user_id | Integer | FK(users.id), NOT NULL | ユーザーID |
| product_id | Integer | FK(products.id), NOT NULL | 商品ID |
| price_threshold | Decimal(10,2) | NULL | 価格閾値 |
| threshold_type | String(20) | NOT NULL, DEFAULT 'list_price' | 閾値タイプ（list_price/effective_price） |
| threshold_percentage | Integer | NULL | 閾値割合（%） |
| notification_enabled | Boolean | NOT NULL, DEFAULT TRUE | 通知有効フラグ |
| display_order | Integer | NOT NULL, DEFAULT 0 | 表示順 |
| memo | Text | NULL | メモ |
| created_at | DateTime | NOT NULL | 作成日時 |
| updated_at | DateTime | NOT NULL | 更新日時 |

### PriceHistory（price_histories）

| フィールド名 | データ型 | 制約 | 説明 |
| --- | --- | --- | --- |
| id | Integer | PK, AUTO_INCREMENT | ID |
| product_on_ec_site_id | Integer | FK(product_on_ec_sites.id), NOT NULL | 商品ECサイトID |
| price | Decimal(10,2) | NOT NULL | 価格 |
| points | Decimal(10,2) | NOT NULL, DEFAULT 0 | ポイント |
| effective_price | Decimal(10,2) | NOT NULL | 実質価格 |
| captured_at | DateTime | NOT NULL | 価格取得日時 |
| created_at | DateTime | NOT NULL | 作成日時 |

### Notification（notifications）

| フィールド名 | データ型 | 制約 | 説明 |
| --- | --- | --- | --- |
| id | Integer | PK, AUTO_INCREMENT | 通知ID |
| user_id | Integer | FK(users.id), NOT NULL | ユーザーID |
| product_id | Integer | FK(products.id), NOT NULL | 商品ID |
| product_on_ec_site_id | Integer | FK(product_on_ec_sites.id), NOT NULL | 商品ECサイトID |
| type | String(50) | NOT NULL | 通知タイプ |
| message | Text | NOT NULL | 通知メッセージ |
| old_price | Decimal(10,2) | NULL | 旧価格 |
| new_price | Decimal(10,2) | NULL | 新価格 |
| is_read | Boolean | NOT NULL, DEFAULT FALSE | 既読フラグ |
| sent_at | DateTime | NOT NULL | 送信日時 |
| created_at | DateTime | NOT NULL | 作成日時 |

### APIToken（api_tokens）

| フィールド名 | データ型 | 制約 | 説明 |
| --- | --- | --- | --- |
| id | Integer | PK, AUTO_INCREMENT | トークンID |
| user_id | Integer | FK(users.id), NOT NULL | ユーザーID |
| token | String(255) | UNIQUE, NOT NULL | APIトークン |
| expires_at | DateTime | NOT NULL | 有効期限 |
| created_at | DateTime | NOT NULL | 作成日時 |
| updated_at | DateTime | NOT NULL | 更新日時 |

### 3.3 インデックス設計

| テーブル名 | インデックス名 | フィールド | タイプ | 目的 |
| --- | --- | --- | --- | --- |
| users | idx_users_email | email | UNIQUE | メールアドレスによる高速検索 |
| user_products | idx_user_products_user_id | user_id | NORMAL | ユーザー別商品一覧取得の高速化 |
| user_products | idx_user_products_product_id | product_id | NORMAL | 商品別ユーザー検索の高速化 |
| price_histories | idx_price_histories_product_on_ec_site_id | product_on_ec_site_id | NORMAL | 商品価格履歴取得の高速化 |
| price_histories | idx_price_histories_captured_at | captured_at | NORMAL | 日付別価格検索の高速化 |
| notifications | idx_notifications_user_id | user_id | NORMAL | ユーザー別通知一覧取得の高速化 |
| product_on_ec_sites | idx_product_on_ec_sites_product_id_ec_site_id | product_id, ec_site_id | UNIQUE | 商品とECサイトの組み合わせユニーク制約 |

### 3.4 参照制約設計

以下の参照整合性制約を設定する：

- users削除時：user_settingsも削除（CASCADE）
- users削除時：user_productsも削除（CASCADE）
- products削除時：product_on_ec_sitesも削除（CASCADE）
- product_on_ec_sites削除時：price_historiesは残す（NO ACTION）
- ec_sites削除時：product_on_ec_sitesは無効化するのみ（RESTRICT）

## 4. 外部インターフェース設計

### 4.1 外部APIインターフェース

### 4.1.1 Amazon Product Advertising API (PA-API)

**用途:** Amazon商品情報・価格情報の取得

**主要パラメータ:**

- アクセスキー・シークレットキー
- オペレーション：GetItems, SearchItems
- パラメータ：ASIN, キーワード等
- リクエスト制限：推定1秒間に1リクエスト程度に抑える

**エラーハンドリング:**

- 429エラー（レート制限）：指数バックオフ再試行
- 5xxエラー：3回まで再試行
- タイムアウト：30秒

### 4.1.2 楽天商品検索API

**用途:** 楽天市場商品情報・価格情報の取得

**主要パラメータ:**

- アプリケーションID
- アフィリエイトID
- キーワード、商品コード等
- リクエスト制限：デフォルトで1分間に100リクエストまで

**エラーハンドリング:**

- レート制限：キューイングして時間をずらして実行
- エラーレスポンス：ログ記録とアラート通知

### 4.1.3 Yahoo!ショッピングAPI

**用途:** Yahoo!ショッピング商品情報・価格情報の取得

**主要パラメータ:**

- クライアントID・シークレット
- 商品ID、キーワード等
- リクエスト制限：日次の上限あり（詳細は開発時に確認）

**エラーハンドリング:**

- OAuth認証失敗：再認証
- その他エラー：ログ記録とリトライ

### 4.2 メール送信インターフェース

**MVPフェーズでは:** Django組み込みのSMTP機能を利用

**将来拡張:** SendGridなどのメール配信サービスに移行予定

**メール送信頻度制限:**

- ユーザーごとの設定に従う（日次/週次/即時）
- システム全体で1時間あたり300通を上限とする

## 5. 画面設計

### 5.1 画面一覧

### 5.1.1 ユーザー向け画面

| 画面ID | 画面名 | 主な機能 | 遷移先 |
| --- | --- | --- | --- |
| U01 | ランディングページ | サービス説明、登録・ログイン誘導 | U02, U03 |
| U02 | ユーザー登録 | 新規アカウント作成 | U04 |
| U03 | ログイン | 既存アカウントへのログイン | U04 |
| U04 | ダッシュボード | 登録商品一覧、価格変動概要表示 | U05, U06, U07 |
| U05 | 商品登録 | URL入力または検索による商品登録 | U04 |
| U06 | 商品詳細 | 価格履歴グラフ、ECサイト別価格比較、設定 | U04 |
| U07 | ユーザー設定 | 通知設定、アカウント管理 | U04 |
| U08 | 通知一覧 | 価格アラート通知履歴の表示 | U06 |

### 5.1.2 管理者向け画面

| 画面ID | 画面名 | 主な機能 | 備考 |
| --- | --- | --- | --- |
| A01 | 管理者ログイン | 管理者認証 | Django管理画面利用 |
| A02 | ダッシュボード | システム概要統計 | Django管理画面利用 |
| A03 | ユーザー管理 | ユーザー一覧、詳細、編集 | Django管理画面利用 |
| A04 | 商品管理 | 商品一覧、詳細、編集 | Django管理画面利用 |
| A05 | 価格履歴管理 | 価格データの閲覧、編集 | Django管理画面利用 |
| A06 | ログ管理 | システムログの閲覧 | Django管理画面利用 |

### 5.2 主要画面ワイヤーフレーム

### 5.2.1 ダッシュボード画面（U04）

![](https://claude.ai/chat/dashboard_wireframe.png)

※基本設計書の一部として、実際の図は別途添付

### レイアウト構成

- ヘッダー：ロゴ、ナビゲーション、ユーザーメニュー
- 概要パネル：登録商品数、価格下落商品数、潜在的節約額
- 商品一覧：カード形式で表示
    - 商品画像
    - 商品名
    - 現在価格（最安値）
    - 価格変動インジケータ
    - 簡易グラフ
- 新規追加ボタン：右下固定の目立つボタン

### 5.2.2 商品詳細画面（U06）

![](https://claude.ai/chat/product_detail_wireframe.png)

※基本設計書の一部として、実際の図は別途添付

### レイアウト構成

- 商品基本情報：画像、タイトル、メーカー等
- 価格情報タブ
    - インタラクティブ価格履歴グラフ
    - 期間選択（1週間/1ヶ月/3ヶ月/1年）
    - 価格種別切替（販売価格/実質価格）
    - ECサイト別価格比較テーブル
- アラート設定タブ
    - 価格閾値設定（スライダー）
    - 通知タイプ選択
    - 価格タイプ選択（表示価格/実質価格）

## 6. 処理フロー設計

### 6.1 商品登録プロセス

```
[ユーザー] → 商品URL入力 → [システム]
→ URL解析・ECサイト判別 → 商品情報取得 → 既存商品チェック
→ 商品情報表示 → [ユーザー] → 設定調整・確認 → [システム]
→ 商品DB登録 → UserProduct関連付け → 初期価格取得
→ アフィリエイトリンク生成 → 完了通知

```

### 6.2 定期価格チェックプロセス

```
[Celeryタスク] → 価格チェック対象抽出 → ECサイトAPI呼び出し
→ 価格データ取得 → 前回価格と比較 → DB更新
→ 条件判定（閾値超え） → 通知条件確認 → 通知生成 → 通知送信

```

### 6.3 通知送信プロセス

```
[通知キュー] → 通知タイプ判別 → テンプレート選択
→ 商品データ取得 → グラフ生成 → メール本文生成
→ アフィリエイトリンク挿入 → メール送信 → 送信ログ記録

```

### 6.4 実質価格計算プロセス

```
販売価格取得 → ポイント情報取得 → ポイント還元率計算
→ 獲得ポイント計算 → 販売価格 - 獲得ポイント = 実質価格
→ DB保存

```

## 7. セキュリティ設計

### 7.1 認証・認可

- **認証方式:** JWTを用いたトークンベース認証
- **パスワード要件:**
    - 8文字以上
    - 大文字・小文字・数字を含む
    - BCryptによるハッシュ化
- **認証失敗対策:** 5回連続失敗でIPアドレスベースの一時ブロック
- **権限管理:** ロールベース（一般ユーザー/管理者）

### 7.2 データ保護

- **通信暗号化:** HTTPS（TLS 1.3）
- **機密データ保護:** パスワード等の機密情報は暗号化して保存
- **クロスサイトスクリプティング対策:**
    - 入力検証
    - エスケープ処理
    - Content Security Policy設定
- **SQL インジェクション対策:**
    - パラメータ化クエリ
    - ORMの活用

### 7.3 APIセキュリティ

- **CSRF対策:** Django組み込みのCSRFトークン機能
- **レート制限:** ユーザー/IPベースのレート制限
- **APIキー管理:** 安全なキー生成と定期的なローテーション

### 7.4 スクレイピングセキュリティ

- **User-Agent設定:** 適切なUser-Agentヘッダーの設定
- **アクセス間隔:** 最低5秒以上の間隔でアクセス
- **robots.txt遵守:** 各サイトのrobots.txtを遵守
- **エラー処理:** CAPTCHAやブロック検出時の適切な処理

## 8. インフラストラクチャ設計

### 8.1 MVPフェーズでのインフラ

コスト最小化のため、以下の無料・低コストサービスを活用：

### 8.1.1 アプリケーションホスティング

**選択肢1: Render**

- Webサービス（無料枠）：Djangoアプリケーション
- PostgreSQLデータベース（無料枠）
- 自動デプロイ（GitHub連携）

**選択肢2: Firebase**

- Firebase Hosting：フロントエンド（静的ファイル）
- Cloud Functions：バックエンドAPI
- Firestore：データベース（初期段階）

**選択肢3: PythonAnywhere**

- 無料枠でDjangoアプリケーションのホスティング
- SQLiteデータベース（初期段階）

### 8.1.2 バックグラウンド処理

**MVPフェーズ:**

- Heroku Scheduler / GitHub Actions：定期的なデータ収集スクリプト実行

**拡張フェーズ:**

- Celery + Redis Cloud（無料枠）

### 8.1.3 開発・CI/CD環境

- GitHub：ソースコード管理
- GitHub Actions：CI/CD
- Docker：開発環境の統一（ローカル環境）

### 8.2 将来的なインフラ

ユーザー増加に伴う将来的なインフラ検討：

- AWS Elastic Beanstalk / Google App Engine：スケーラブルなアプリケーションホスティング
- Amazon RDS / Google Cloud SQL：マネージドデータベース
- Redis / Memcached：キャッシュ層
- CDN：静的コンテンツ配信の高速化

## 9. 性能要件と対策

### 9.1 レスポンス時間

- ページロード：3秒以内
- API応答：95%のリクエストが500ms以内

### 9.2 同時アクセス対応

- 初期：最大20ユーザーの同時アクセスに対応
- 将来：段階的に拡張（100ユーザー→1000ユーザー）

### 9.3 性能最適化施策

### 9.3.1 フロントエンド最適化

- 画像の最適化（WebP形式、適切なサイズ）
- レスポンシブ画像（デバイスに合わせた画像サイズ）
- コード分割（Code Splitting）
- レンダリングパフォーマンス最適化

### 9.3.2 バックエンド最適化

- **データベース最適化:**
    - インデックス設計
    - クエリの最適化
    - 必要に応じてキャッシュ導入
- **APIレスポンス最適化:**
    - 必要最小限のデータ返却
    - ページネーション
    - 部分的なレスポンス

### 9.3.3 データ収集最適化

- バッチ処理による定期実行
- API呼び出し回数の最小化（商品グループ化）
- 価格変動頻度に応じた更新頻度の調整

## 10. MVPリリース計画

### 10.1 MVPスコープ

### 10.1.1 MVPに含める機能

- **ユーザー機能**
    - メールとパスワードによる基本認証
    - 基本的なユーザー設定
- **商品登録・管理**
    - URL入力による商品登録
- **EC間の価格比較**
    - Amazon限定、シンプル版
- **価格トラッキング**
    - 販売価格のみの追跡（実質価格計算は含まず）
    - シンプルな価格履歴グラフ表示
    - 基本的なアラート機能（設定価格を下回った場合のみ）
- **通知機能**
    - メールによる価格下落通知
    - 最小限のテンプレート（商品情報、現在価格、購入リンク）
- **アフィリエイト**
    - Amazon限定の基本的なアフィリエイトリンク機能

### 10.1.2 MVPフェーズで除外する機能

- 実質価格計算（ポイント還元を考慮した価格表示）
- 楽天市場およびYahoo!ショッピング対応
- 高度な価格アラート条件設定
- レビュー情報収集・分析
- 商品のカテゴリ分類・管理
- ソーシャル共有機能
- カスタマイズ可能なダッシュボード
- モバイルアプリケーション版

### 10.2 MVP開発スケジュール

### 10.2.1 全体スケジュール（3ヶ月）

```
フェーズ期間主な作業内容基盤開発4週間要件定義完了、DB設計、Django基本構築、認証実装コア機能開発4週間Amazon連携、価格取得、履歴保存、フロントエンド開発仕上げ・テスト4週間通知機能、アフィリエイト連携、テスト、デプロイ
```

### 10.2.2 詳細マイルストーン

```
#マイルストーン予定日成果物1基本設計完了W1末最終基本設計書2データベース構築W2末物理DB構造、Django models3ユーザー認証実装W3末ログイン/登録フロー完成4Amazon API連携W5末商品情報取得、価格取得機能5価格履歴実装W6末価格記録・取得API6フロントエンド基盤W7末Vue.js基本構造、主要画面7グラフ表示機能W8末価格履歴グラフ機能8通知機能実装W10末メール通知システム9アフィリエイト連携W11末Amazonアフィリエイト変換10MVPリリースW12末運用環境デプロイ
```

### 10.3 フィードバック収集計画

### 10.3.1 ベータテスト段階

- 限定ユーザー（開発チームの知人・友人10〜20名）へのアクセス提供
- フィードバックフォームの設置（Google Forms使用）
- 週次のフィードバックレビュー会議
- 重大な問題のみW11までに対応

### 10.3.2 MVP公開後の計測指標

- 登録ユーザー数と継続率
- 1ユーザーあたりの登録商品数
- 通知メールの開封率・クリック率
- アフィリエイトリンク経由の売上
- 各機能の使用率（ヒートマップ分析）
- エラー発生率とバグレポート数

## 11. テスト計画

### 11.1 テスト方針

MVPフェーズでは最小限かつ効率的なテストアプローチを採用し、コストを抑えながら品質を確保する。

### 11.2 テストレベル

### 11.2.1 単体テスト

- **対象**: コアロジック（価格取得、通知判定、アフィリエイト変換など）
- **方法**: Django TestCase、pytest
- **自動化**: GitHub Actionsで自動実行
- **目標カバレッジ**: コアロジックで70%以上

### 11.2.2 統合テスト

- **対象**: API連携、データフロー全体
- **方法**: APIリクエスト/レスポンステスト、セッション流れのテスト
- **ツール**: Django TestCase、pytest
- **範囲**: 主要な処理フロー（商品登録〜価格取得〜通知）

### 11.2.3 UIテスト

- **対象**: 主要画面の表示・操作性
- **方法**: 手動テスト中心（自動化は最小限）
- **ツール**: 手動チェックリスト、必要に応じてSelenium
- **範囲**: ログイン、商品登録、ダッシュボード表示、設定操作

### 11.2.4 非機能テスト

- **パフォーマンス**: 少人数環境での応答性検証
- **セキュリティ**: 基本的な脆弱性チェック（OWASP Top 10対応）
- **互換性**: 主要ブラウザ（Chrome、Safari、Edge）での動作確認

### 11.3 テスト環境

```
環境用途構成開発環境開発者によるテストローカルDocker環境検証環境統合テスト、手動テストRender無料枠または同等サービスステージング環境リリース前最終確認本番相当環境（小規模）本番環境サービス提供Render/Firebase等選定サービス
```

### 11.4 テスト実施計画

### 11.4.1 テストフェーズ

```
フェーズ時期内容開発者テスト開発中随時単体テスト、機能テストアルファテストW9〜W10開発チーム内でのフルフロー検証ベータテストW11限定ユーザーによる実環境テスト最終検証W12前半リリース準備状態の総合検証
```

### 11.4.2 主要テストケース（概要）

- ユーザー登録・認証フロー
- 商品URL登録プロセス
- 価格情報取得エラー処理
- 価格アラート条件判定処理
- 通知メール送信処理
- アフィリエイトリンク変換処理
- モバイル/デスクトップ表示互換性

### 11.5 バグトラッキング

- **ツール**: GitHub Issues
- **重要度分類**:
    - Critical: サービス全体に影響、即時対応
    - High: 主要機能に影響、リリース前に対応必須
    - Medium: 一部機能に影響、計画的に対応
    - Low: 軽微な問題、余裕があれば対応

## 12. 運用・保守設計

### 12.1 運用体制

MVPフェーズでは最小限の運用体制とし、ローコストを維持:

### 12.1.1 役割分担

- **開発者**: アプリケーション保守、軽微な改修対応
- **プロジェクトマネージャー**: サービス運営管理、ユーザーフィードバック収集
- **外部サポート**: 必要に応じて臨時対応（大規模改修時）

### 12.1.2 サポート体制

- **ユーザーサポート**: メールでの問い合わせ対応
- **応答時間目標**: 営業日2日以内
- **FAQ**: よくある質問をヘルプページに整備

### 12.2 監視・アラート体制

### 12.2.1 監視対象

- **サーバーヘルス**: CPU使用率、メモリ使用率、ディスク使用率
- **アプリケーション**: エラー発生率、API応答時間
- **価格収集処理**: 成功率、処理時間
- **サードパーティAPI**: 可用性、応答時間、エラーレート

### 12.2.2 アラート設定

- **致命的問題**: 即時通知（メール、SMS）
    - サービス停止
    - データ収集プロセス全体の失敗
    - セキュリティインシデント
- **警告レベル**: メールのみ通知
    - 処理遅延
    - エラー率の上昇
    - リソース使用率の閾値超過

### 12.3 バックアップ計画

### 12.3.1 バックアップ対象

- **データベース**: 全テーブル
- **メディアファイル**: 商品画像等
- **アプリケーションコード**: Git管理

### 12.3.2 バックアップ頻度

- **データベース**:
    - 差分バックアップ: 日次
    - 完全バックアップ: 週次
- **コード**: 変更時にGitでコミット
- **設定ファイル**: 変更時にバックアップ

### 12.3.3 保存期間

- 日次バックアップ: 2週間
- 週次バックアップ: 1ヶ月
- 月次バックアップ: 3ヶ月

### 12.4 障害復旧計画

### 12.4.1 想定障害シナリオ

1. **サーバーダウン**: ホスティングサービスの問題
2. **データベース障害**: データ破損、接続エラー
3. **外部API連携障害**: Amazon APIの一時的障害
4. **価格収集プロセス障害**: スクレイピング障害、レート制限超過

### 12.4.2 復旧手順概要

1. **インフラ障害**: サービスプロバイダへの連絡、バックアップ環境への切り替え
2. **データベース復旧**: 最新バックアップからのリストア
3. **アプリケーション障害**: 最後の安定バージョンへのロールバック
4. **外部API障害**: 取得頻度の低減、代替データ収集手段の一時的実装

### 12.4.3 RTO（Recovery Time Objective）

- **致命的障害**: 24時間以内
- **重大障害**: 12時間以内
- **通常障害**: 営業日内

### 12.5 リリース・デプロイメント戦略

### 12.5.1 デプロイメントプロセス

- **CI/CD**: GitHub Actionsによる自動テスト・デプロイ
- **ブランチ戦略**: GitHub Flow（feature → main）
- **デプロイ頻度**: 初期は週1回、安定後は隔週

### 12.5.2 変更管理

- **変更申請**: GitHub Issue作成
- **変更承認**: コードレビュー後、PM承認
- **変更記録**: GitHub PRとコミット履歴
- **変更通知**: 影響範囲に応じてユーザーへ事前通知

### 12.6 パフォーマンス管理

### 12.6.1 パフォーマンス指標

- **ページロード時間**: 平均・95パーセンタイル
- **API応答時間**: エンドポイント別の応答時間
- **データ処理時間**: 価格収集バッチの実行時間
- **リソース使用率**: CPU、メモリ、ディスク、DB接続数

### 12.6.2 キャパシティ計画

- **初期スケール**: 同時アクセス最大20ユーザー想定
- **将来拡張**: 月間ユーザー数の倍増に備えた拡張計画
- **リソース監視**: 使用率80%超で拡張検討

### 12.7 セキュリティ運用

### 12.7.1 定期的セキュリティチェック

- **脆弱性スキャン**: 月次実施
- **依存パッケージ更新**: セキュリティアップデートは優先対応
- **アクセスログ監視**: 異常なアクセスパターンの検出

### 12.7.2 インシデント対応

- **検知**: ログ監視、アラート
- **対応**: サービス影響範囲の特定と遮断
- **復旧**: 安全な状態への復元
- **報告**: 必要に応じたユーザーへの通知

### 12.8 保守計画

### 12.8.1 定期保守

- **パッチ適用**: セキュリティパッチは随時、機能パッチは月次
- **データクリーニング**: 不要データの整理（四半期ごと）
- **パフォーマンスチューニング**: 必要に応じて実施

### 12.8.2 技術的負債管理

- **コード品質**: 定期的なリファクタリング計画
- **ドキュメント更新**: システム変更時に随時更新
- **依存関係管理**: ライブラリ・フレームワークの更新計画

## 13. 拡張フェーズ計画

### 13.1 第1拡張フェーズ（MVPリリース後2ヶ月）

### 13.1.1 実質価格計算機能

- **獲得ポイント情報取得機能**
    - 楽天ポイント、Amazonポイント等の自動収集
    - ポイント還元率のパターン認識と計算ロジック
- **実質価格表示UI**
    - 販売価格と実質価格の並列表示
    - グラフ表示での切り替え機能

### 13.1.2 楽天市場対応

- **楽天商品検索API連携**
    - 楽天APIキー取得
    - 商品情報マッピング
    - 価格・ポイント情報取得
- **楽天アフィリエイト対応**
    - アフィリエイトID管理
    - リンク変換ロジック

### 13.1.3 価格アラート機能強化

- **複数条件アラート設定**
    - 価格下落率基準のアラート
    - 期間指定アラート
- **通知頻度設定**
    - 即時/日次/週次の選択オプション

### 13.2 第2拡張フェーズ（第1拡張後2ヶ月）

### 13.2.1 Yahoo!ショッピング対応

- **Yahoo!ショッピングAPI連携**
    - API連携構築
    - 商品情報マッピング
- **Yahoo!ショッピングアフィリエイト対応**
    - バリューコマース連携

### 13.2.2 グラフ機能強化

- **高度なグラフ表示**
    - 期間カスタマイズ
    - 複数ECサイト同時表示
    - ズーム・パン機能
- **データエクスポート機能**
    - CSV/JSONフォーマット対応

### 13.2.3 EC間価格比較強化

- **同一商品自動マッチング**
    - JAN/ASINコードによる紐付け
    - 商品名類似度計算
- **最安値ランキング表示**
    - 実質価格ベースのランキング
    - 配送コスト考慮オプション

### 13.3 第3拡張フェーズ（第2拡張後3ヶ月）

### 13.3.1 レビュー情報収集

- **レビュースコア収集**
    - 星評価の集計
    - レビュー数トラッキング
- **レビュー傾向分析**
    - 簡易センチメント分析
    - キーワード抽出

### 13.3.2 類似商品推奨

- **類似商品検索**
    - カテゴリベース推奨
    - 価格帯マッチング
- **代替品提案**
    - より安価な類似品提案
    - 高評価代替品提案

### 13.3.3 ダッシュボードカスタマイズ

- **ウィジェット選択機能**
    - 表示項目選択
    - レイアウト調整
- **カスタムビュー保存**
    - 複数ビューの切り替え

### 13.4 将来拡張検討項目

### 13.4.1 モバイルアプリ開発

- **ネイティブアプリ検討**
    - iOS/Android対応
    - プッシュ通知実装
- **バーコードスキャン機能**
    - 店頭価格との比較

### 13.4.2 高度な価格予測

- **機械学習導入**
    - 価格変動パターン学習
    - セール予測アルゴリズム
- **購入タイミング推奨**
    - 最適購入時期提案

### 13.4.3 ソーシャル機能

- **価格情報共有**
    - SNS連携
    - 共有リンク生成
- **コミュニティ機能**
    - 商品レビュー投稿
    - お買い得情報共有

### 13.4.4 収益化モデル拡張

- **フリーミアムモデル**
    - 基本機能無料、高度機能有料
    - 登録商品数上限拡張（有料）
- **広告モデル検討**
    - 非侵襲的な関連商品広告

## 14. 終わりに

### 14.1 基本設計のまとめ

本設計書では、ECサイト価格追跡システム「PriceAlert」の基本設計を記述した。ユーザーが商品の価格変動を簡単に追跡し、最適なタイミングで購入判断ができるシステムの実現を目指している。

設計のポイントは以下のとおり：

1. **コスト最小化** - 無料・低コストサービスを最大限活用し、初期投資を抑制
2. **段階的開発** - MVPからスタートし、ユーザーフィードバックを得ながら機能拡張
3. **拡張性考慮** - 将来的な機能追加や負荷増大に対応できるアーキテクチャ設計
4. **実質価格重視** - 単なる表示価格だけでなく、ポイント還元を加味した実質価格の計算・表示

### 14.2 開発に向けた提言

本システムの開発にあたっては以下の点に注意することを推奨する：

1. **外部依存リスク管理** - EC各社のAPI制限・利用規約変更への対応策を常に検討
2. **データ収集倫理の遵守** - 過度なスクレイピングを避け、各サイトのロボット規約を遵守
3. **ユーザー中心設計** - 早期からテストユーザーのフィードバックを取り入れた改善サイクル
4. **技術負債の管理** - 短期的な実装と長期的な保守性のバランスを意識

### 14.3 今後の課題と検討事項

本設計を進める上で、以下の課題について引き続き検討が必要である：

1. **EC各社APIの詳細調査** - 呼び出し制限、取得可能データ項目の精査
2. **実質価格計算の精度向上** - ポイント還元率の正確な取得方法の確立
3. **同一商品マッチングアルゴリズムの改善** - より精度の高いマッチング手法の検討
4. **長期的な収益モデル構築** - アフィリエイト以外の収益化手段の検討

---

本基本設計書は、要件定義を基に策定された初期設計である。実装段階で発生する課題や新たな知見に応じて柔軟に調整していくものとする。次のステップとして、詳細設計および開発環境構築を進めていく。